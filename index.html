<!DOCTYPE html>
<html>
  <head>
    <script src="js/jquery.js"></script>
    <script src="js/data_generator.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.timeago.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/stylesheet.css">
  </head>
  <body>
    <script>

      $(document).ready(function(){
        let $body = $('body');
        let $tweetbox = $('<div></div>').addClass('tweetbox'); // container for all tweets
        let $rightgrid = $('<div></div>').addClass('col-md-3'); // create bootstrap grid right padding
        let $leftgrid = $('<div></div>').addClass('col-md-3'); // create bootstrap grid left padding
        let $middlegrid = $('<div></div>').addClass('col-md-6'); // create bootstrap center grid for content
        let $button = $('<button></button>').addClass('btn').addClass('btn-success').text('Auto Update: Off').addClass('toggle-btn');
        // Navbar and button
        let $navbar = $('<nav></nav>').addClass('navbar-default').addClass('container-fluid').addClass('navbar-fixed-top');
        let $brand = $('<a></a>').addClass('navbar-brand').text('Twittler by Daniel Shneyder');
        let $navbarnav = $('<ul></ul>').addClass('nav').addClass('navbar-nav').addClass('navbar-right');
        let $navbarform = $('<form></form>').addClass('navbar-form').addClass('navbar-right');

        $brand.appendTo($navbar);

        $body.html(''); // emptying the body
        $leftgrid.appendTo($body);
        $middlegrid.appendTo($body);
        $tweetbox.appendTo($middlegrid);
        $rightgrid.appendTo($body);
        $navbar.prependTo($body);
        $navbarnav.appendTo($navbar);
        $navbarform.appendTo($navbarnav);
        $button.appendTo($navbarform);

        let currentTweet = 0;
        function loadTweets(){
          let allTweets = streams.home.length - 1;
            while(currentTweet < allTweets){
              let $tweet = $('<div></div>').addClass('tweet-body');
              let $tweetDate = $('<span></span>').addClass('tweet-date');
              let tweet = streams.home[currentTweet];
              $tweetDate.text(`${jQuery.timeago(tweet.created_at)} `);
              $tweet.text(`@${tweet.user}: ${tweet.message}`);
              $tweet.appendTo($tweetbox);
              $tweetDate.prependTo($tweet);
              currentTweet++;
            }
        }
        // function update() {
        //   let index = streams.home.length
        // }
        loadTweets(); // Initial call to generate tweets.
        let intervalID;
        //$button.prependTo($body); // make sure button stays at the top of the page
        $button.click(function(event) {
          event.preventDefault(); // button click handler // trigger auto refresh
          if ($(this).text() === 'Auto Update: Off') {
            $(this).text('Auto Update: On');
            $(this).removeClass('btn-success').addClass('btn-warning');
            if (!intervalID) {
              intervalID = window.setInterval(loadTweets, 1000);
            }
            console.log(`Auto Update Started with Interval ID: ${intervalID}`)
          } else {
            $(this).text('Auto Update: Off');
            $(this).removeClass('btn-warning').addClass('btn-success');
            window.clearInterval(intervalID);
            console.log(`Auto Update Stopped with Interval ID: ${intervalID}`)
          }
        })


      });

    </script>
  </body>
</html>
